language: node_js

sudo: required

node_js:
    - 5.1

addons:
  firefox: "30.0"

env:
  - BROWSER='Chrome'  USE_ES6=false
  - BROWSER='Chrome'  USE_ES6=true
  - BROWSER='Firefox' USE_ES6=false
  - BROWSER='Firefox' USE_ES6=true
  - BROWSER='Opera'   USE_ES6=false
  - BROWSER='Opera'   USE_ES6=true

before_install:
  # For Google Chrome
  - echo "deb http://security.ubuntu.com/ubuntu trusty-security main" | sudo tee -a /etc/apt/sources.list
  - echo "deb http://cz.archive.ubuntu.com/ubuntu trusty main" | sudo tee -a /etc/apt/sources.list
  - wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
  - wget http://kent.dl.sourceforge.net/project/ubuntuzilla/mozilla/apt/pool/main/f/firefox-mozilla-build/firefox-mozilla-build_45.0.2-0ubuntu1_amd64.deb
  - wget http://download1.operacdn.com/pub/opera/desktop/29.0.1795.60/linux/opera-stable_29.0.1795.60_amd64.deb
  - wget http://download1.operacdn.com/pub/opera/desktop/27.0.1689.54/linux/opera-stable_27.0.1689.54_amd64.deb

install:
  - sudo apt-get update
    # Download and install version of Chrome/Opera/Firefox which supports ES6 Class.
  - if [[ "$USE_ES6" == true ]]; then sudo apt-get install -y libappindicator1 fonts-liberation; fi
  - if [[ "$USE_ES6" == true ]]; then sudo dpkg -i google-chrome*.deb opera-stable_29*.deb firefox-mozilla-build_45*.deb; fi
     # Just download Opera, Chromium and Firefox are already installed
  - if [[ "$USE_ES6" == false ]]; then sudo dpkg -i opera-stable_27*.deb; fi
  - npm install

before_script:
  - export CHROME_BIN=chromium-browser
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
  - echo "Firefox version => $(firefox -v)"
  - echo "Chromium version => $(chromium-browser --version)"
  - echo "Opera version => $(opera --version)"
  - echo "Using ES6? => " $USE_ES6

script: npm test